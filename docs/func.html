<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Iteration &amp; Functions | Data Skills for Reproducible Research</title>
<meta name="description" content="8.1 Learning Objectives You will learn about functions and iteration by using simulation to calculate a power analysis for an independent samples t-test. Basic Work with basic iteration functions...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 8 Iteration &amp; Functions | Data Skills for Reproducible Research">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/reprores-v3/func.html">
<meta property="og:image" content="https://psyteachr.github.io/reprores-v3/images/logos/logo.png">
<meta property="og:description" content="8.1 Learning Objectives You will learn about functions and iteration by using simulation to calculate a power analysis for an independent samples t-test. Basic Work with basic iteration functions...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Iteration &amp; Functions | Data Skills for Reproducible Research">
<meta name="twitter:description" content="8.1 Learning Objectives You will learn about functions and iteration by using simulation to calculate a power analysis for an independent samples t-test. Basic Work with basic iteration functions...">
<meta name="twitter:image" content="https://psyteachr.github.io/reprores-v3/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.23/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="&lt;br&gt;&lt;a href='https://doi.org/10.5281/zenodo.6527194'&gt;&lt;img src='https://zenodo.org/badge/DOI/10.5281/zenodo.6527194.svg' alt='DOI: 10.5281/zenodo.6527194'&gt;&lt;/a&gt;">Data Skills for Reproducible Research</a>:
        <small class="text-muted"><br><a href="https://doi.org/10.5281/zenodo.6527194"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.6527194.svg" alt="DOI: 10.5281/zenodo.6527194"></a></small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Getting Started</a></li>
<li><a class="" href="repro.html"><span class="header-section-number">2</span> Reproducible Workflows</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">3</span> Data Visualisation</a></li>
<li><a class="" href="data.html"><span class="header-section-number">4</span> Working with Data</a></li>
<li><a class="" href="joins.html"><span class="header-section-number">5</span> Data Relations</a></li>
<li><a class="" href="tidyr.html"><span class="header-section-number">6</span> Tidy Data</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">7</span> Data Wrangling</a></li>
<li><a class="active" href="func.html"><span class="header-section-number">8</span> Iteration &amp; Functions</a></li>
<li><a class="" href="sim.html"><span class="header-section-number">9</span> Probability &amp; Simulation</a></li>
<li><a class="" href="custom.html"><span class="header-section-number">10</span> Customising Visualisations &amp; Reports</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installingr.html"><span class="header-section-number">A</span> Installing and Updating</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">B</span> Getting Help</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/reprores-v3">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="func" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Iteration &amp; Functions<a class="anchor" aria-label="anchor" href="#func"><i class="fas fa-link"></i></a>
</h1>
<div class="right meme">
<img src="images/memes/functions.jpg" alt="History channel aliens conspiracy guy. Top text: I've got functions inside functions...; Bottom text: ... inside functions.">
</div>
<div id="ilo-func" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Learning Objectives<a class="anchor" aria-label="anchor" href="#ilo-func"><i class="fas fa-link"></i></a>
</h2>
<p>You will learn about functions and iteration by using simulation to calculate a power analysis for an independent samples t-test.</p>
<div id="basic-3" class="section level3 unnumbered">
<h3>Basic<a class="anchor" aria-label="anchor" href="#basic-3"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Work with basic <a href="func.html#iteration-functions">iteration functions</a> <code>rep</code>, <code>seq</code>, <code>replicate</code> <a href="https://youtu.be/X3zFA71JzgE" class="video">(video)</a>
</li>
<li>Use <a href="func.html#map-apply"><code>map()</code> and <code>apply()</code> functions</a> <a href="https://youtu.be/HcZxQZwJ8T4" class="video">(video)</a>
</li>
<li>Write your own <a href="func.html#custom-functions">custom functions</a> with <code>function()</code> <a href="https://youtu.be/Qqjva0xgYC4" class="video">(video)</a>
</li>
<li>Set <a href="func.html#defaults">default values</a> for the arguments in your functions</li>
</ol>
</div>
<div id="intermediate-3" class="section level3 unnumbered">
<h3>Intermediate<a class="anchor" aria-label="anchor" href="#intermediate-3"><i class="fas fa-link"></i></a>
</h3>
<ol start="5" style="list-style-type: decimal">
<li>Understand <a href="func.html#scope">scope</a>
</li>
<li>Use <a href="func.html#warnings-errors">error handling and warnings</a> in a function</li>
</ol>
</div>
<div id="advanced" class="section level3 unnumbered">
<h3>Advanced<a class="anchor" aria-label="anchor" href="#advanced"><i class="fas fa-link"></i></a>
</h3>
<div class="right meme">
<img src="images/memes/purrr.gif" alt="Jacobim Mugatu (Will Ferrell) and Katinka Ingabogovinanana (Mila Jojovich) from Zoolander, sitting in a theatre with a small dog; bottom text: purrr::map so hot right now">
</div>
<p>The topics below are not (yet) covered in these materials, but they are directions for independent learning.</p>
<ol start="7" style="list-style-type: decimal">
<li>Repeat commands having multiple arguments using <code>purrr::map2_*()</code> and <code>purrr::pmap_*()</code>
</li>
<li>Create <strong>nested data frames</strong> using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::nest()</a></code>
</li>
<li>Work with <strong>nested data frames</strong> in <code>dplyr</code>
</li>
<li>Capture and deal with errors using 'adverb' functions <code><a href="https://purrr.tidyverse.org/reference/safely.html">purrr::safely()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/safely.html">purrr::possibly()</a></code>
</li>
</ol>
<p>In the next two lectures, we are going to learn more about <a class="glossary" target="_blank" title="Repeating a process or function" href="https://psyteachr.github.io/glossary/i#iteration">iteration</a> (doing the same commands over and over) and custom <a class="glossary" target="_blank" title="A named section of code that can be reused." href="https://psyteachr.github.io/glossary/f#function">functions</a> through a data simulation exercise, which will also lead us into more traditional statistical topics.</p>
</div>
</div>
<div id="setup-func" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Setup<a class="anchor" aria-label="anchor" href="#setup-func"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Open your <code>reprores-class-notes</code> project</li>
<li>Create a new R Markdown file called <code>08-func.Rmd</code>
</li>
<li>Update the YAML header</li>
<li>Replace the setup chunk with the one below:</li>
</ol>
<div class="verbatim">
<pre class="sourceCode r"><code class="sourceCode R">```{r setup, include = FALSE}</code></pre>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># packages needed for this chapter</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>  <span class="co"># loads purrr for iteration</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>      <span class="co"># converts test output to tidy tables</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8675309</span><span class="op">)</span> <span class="co"># makes sure random numbers are reproducible</span></span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode R">```</code></pre>
</div>
<p>Download the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/purrr.pdf">Apply functions with purrr cheat sheet</a>.</p>
</div>
<div id="iteration-functions" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Iteration functions<a class="anchor" aria-label="anchor" href="#iteration-functions"><i class="fas fa-link"></i></a>
</h2>
<p>We first learned about the two basic iteration functions, <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code> and <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> in the <a href="data.html#rep_seq">Working with Data</a> chapter.</p>
<div id="rep" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> rep()<a class="anchor" aria-label="anchor" href="#rep"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code> lets you repeat the first argument a number of times.</p>
<p>Use <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code> to create a vector of alternating <code>"A"</code> and <code>"B"</code> values of length 24.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A"
## [20] "B" "A" "B" "A" "B"</code></pre>
<p>If you don't specify what the second argument is, it defaults to <code>times</code>, repeating the vector in the first argument that many times. Make the same vector as above, setting the second argument explicitly.</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A"
## [20] "B" "A" "B" "A" "B"</code></pre>
<p>If the second argument is a vector that is the same length as the first argument, each element in the first vector is repeated than many times. Use <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code> to create a vector of 11 <code>"A"</code> values followed by 3 <code>"B"</code> values.</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "B" "B" "B"</code></pre>
<p>You can repeat each element of the vector a sepcified number of times using the <code>each</code> argument, Use <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code> to create a vector of 12 <code>"A"</code> values followed by 12 <code>"B"</code> values.</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "B" "B" "B" "B" "B" "B" "B"
## [20] "B" "B" "B" "B" "B"</code></pre>
<p>What do you think will happen if you set both <code>times</code> to 3 and <code>each</code> to 2?</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">3</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "A" "A" "B" "B" "A" "A" "B" "B" "A" "A" "B" "B"</code></pre>
</div>
<div id="seq" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> seq()<a class="anchor" aria-label="anchor" href="#seq"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> is useful for generating a sequence of numbers with some pattern.</p>
<p>Use <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> to create a vector of the integers 0 to 10.</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1]  0  1  2  3  4  5  6  7  8  9 10</code></pre>
<p>You can set the <code>by</code> argument to count by numbers other than 1 (the default). Use <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> to create a vector of the numbers 0 to 100 by 10s.</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1]   0  10  20  30  40  50  60  70  80  90 100</code></pre>
<p>The argument <code>length.out</code> is useful if you know how many steps you want to divide something into. Use <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> to create a vector that starts with 0, ends with 100, and has 12 equally spaced steps (hint: how many numbers would be in a vector with 2 <em>steps</em>?).</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, length.out <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1]   0.000000   8.333333  16.666667  25.000000  33.333333  41.666667
##  [7]  50.000000  58.333333  66.666667  75.000000  83.333333  91.666667
## [13] 100.000000</code></pre>
</div>
<div id="replicate" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> replicate()<a class="anchor" aria-label="anchor" href="#replicate"><i class="fas fa-link"></i></a>
</h3>
<p>You can use the <code><a href="https://rdrr.io/r/base/lapply.html">replicate()</a></code> function to run a function <code>n</code> times.</p>
<p>For example, you can get 3 sets of 5 numbers from a random normal distribution by setting <code>n</code> to <code>3</code> and <code>expr</code> to <code>rnorm(5)</code>.</p>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,] -0.9965824 0.98721974 -1.5495524
## [2,]  0.7218241 0.02745393  1.0226378
## [3,] -0.6172088 0.67287232  0.1500832
## [4,]  2.0293916 0.57206650 -0.6599640
## [5,]  1.0654161 0.90367770 -0.9945890</code></pre>
<p>By default, <code><a href="https://rdrr.io/r/base/lapply.html">replicate()</a></code> simplifies your result into a <a class="glossary" target="_blank" title="A container data type consisting of numbers arranged into a fixed number of rows and columns" href="https://psyteachr.github.io/glossary/m#matrix">matrix</a> that is easy to convert into a table if your function returns vectors that are the same length. If you'd rather have a list of vectors, set <code>simplify = FALSE</code>.</p>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1]  1.9724587 -0.4418016 -0.9006372 -0.1505882 -0.8278942
## 
## [[2]]
## [1]  1.98582582  0.04400503 -0.40428231 -0.47299855 -0.41482324
## 
## [[3]]
## [1]  0.6832342  0.6902011  0.5334919 -0.1861048  0.3829458</code></pre>
</div>
<div id="map-apply" class="section level3" number="8.3.4">
<h3>
<span class="header-section-number">8.3.4</span> map() and apply() functions<a class="anchor" aria-label="anchor" href="#map-apply"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> and <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> return a list of the same length as a vector or list, each element of which is the result of applying a function to the corresponding element. They function much the same, but purrr functions have some optimisations for working with the tidyverse. We'll be working mostly with purrr functions in this course, but apply functions are very common in code that you might see in examples on the web.</p>
<p>Imagine you want to calculate the power for a two-sample t-test with a mean difference of 0.2 and SD of 1, for all the sample sizes 100 to 1000 (by 100s). You could run the <code><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test()</a></code> function 20 times and extract the values for "power" from the resulting list and put it in a table.</p>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, delta <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">1</span>, type<span class="op">=</span><span class="st">"two.sample"</span><span class="op">)</span></span>
<span><span class="co"># 18 more lines</span></span>
<span><span class="va">p1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, delta <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">1</span>, type<span class="op">=</span><span class="st">"two.sample"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"..."</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p100</span><span class="op">$</span><span class="va">power</span>, <span class="st">"..."</span>, <span class="va">p1000</span><span class="op">$</span><span class="va">power</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
n
</th>
<th style="text-align:left;">
power
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
0.290266404572217
</td>
</tr>
<tr>
<td style="text-align:left;">
...
</td>
<td style="text-align:left;">
...
</td>
</tr>
<tr>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.884788352886661
</td>
</tr>
</tbody>
</table></div>
</div>
<p>However, the <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> functions allow you to perform a function on each item in a vector or list. First make an object <code>n</code> that is the vector of the sample sizes you want to test, then use <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> or <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> to run the function <code><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test()</a></code> on each item. You can set other arguments to <code><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test()</a></code> after the function argument.</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">pcalc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">power.t.test</span>, </span>
<span>                delta <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">1</span>, type<span class="op">=</span><span class="st">"two.sample"</span><span class="op">)</span></span>
<span><span class="co"># or</span></span>
<span><span class="va">pcalc</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">power.t.test</span>, </span>
<span>                delta <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">1</span>, type<span class="op">=</span><span class="st">"two.sample"</span><span class="op">)</span></span></code></pre></div>
<p>These functions return a list where each item is the result of <code><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test()</a></code>, which returns a list of results that includes the named item "power". This is a special list that has a summary format if you just print it directly:</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcalc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 100
##           delta = 0.2
##              sd = 1
##       sig.level = 0.05
##           power = 0.2902664
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<p>But you can see the individual items using the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function.</p>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcalc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## List of 8
##  $ n          : num 100
##  $ delta      : num 0.2
##  $ sd         : num 1
##  $ sig.level  : num 0.05
##  $ power      : num 0.29
##  $ alternative: chr "two.sided"
##  $ note       : chr "n is number in *each* group"
##  $ method     : chr "Two-sample t test power calculation"
##  - attr(*, "class")= chr "power.htest"</code></pre>
<p><code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> is a version of <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> that returns a vector or array instead of a list, where appropriate. The corresponding purrr functions are <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map.html">map_chr()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map.html">map_int()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl()</a></code>, which return vectors with the corresponding <a class="glossary" target="_blank" title="The kind of data represented by an object." href="https://psyteachr.github.io/glossary/d#data-type">data type</a>.</p>
<p>You can extract a value from a list with the function <code>[[</code>. You usually see this written as <code>pcalc[[1]]</code>, but if you put it inside backticks, you can use it in apply and map functions.</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pcalc</span>, <span class="va">`[[`</span>, <span class="st">"power"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] 0.2902664 0.5140434 0.6863712 0.8064964 0.8847884 0.9333687 0.9623901
##  [8] 0.9792066 0.9887083 0.9939638</code></pre>
<p>We use <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl()</a></code> here because the value for "power" is a <a class="glossary" target="_blank" title="A data type representing a real decimal number" href="https://psyteachr.github.io/glossary/d#double">double</a>.</p>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">pcalc</span>, <span class="va">`[[`</span>, <span class="st">"power"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] 0.2902664 0.5140434 0.6863712 0.8064964 0.8847884 0.9333687 0.9623901
##  [8] 0.9792066 0.9887083 0.9939638</code></pre>
<p>We can use the <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> functions inside a <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function to run the <code><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test()</a></code> function on the value of <code>n</code> from each row of a table, then extract the value for "power", and delete the column with the power calculations.</p>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pcalc <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">power.t.test</span>, </span>
<span>                            delta <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                            sd <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                            type<span class="op">=</span><span class="st">"two.sample"</span><span class="op">)</span>,</span>
<span>         power <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">pcalc</span>, <span class="va">`[[`</span>, <span class="st">"power"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pcalc</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:purrr-plot"></span>
<img src="08-func_files/figure-html/purrr-plot-1.png" alt="Power for a two-sample t-test with d = 0.2" width="100%"><p class="caption">
Figure 8.1: Power for a two-sample t-test with d = 0.2
</p>
</div>
</div>
</div>
<div id="custom-functions" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Custom functions<a class="anchor" aria-label="anchor" href="#custom-functions"><i class="fas fa-link"></i></a>
</h2>
<p>In addition to the built-in functions and functions you can access from packages, you can also write your own functions (and eventually even packages!).</p>
<div id="structure-function" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> Structuring a function<a class="anchor" aria-label="anchor" href="#structure-function"><i class="fas fa-link"></i></a>
</h3>
<p>The general structure of a function is as follows:</p>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">my_args</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># process the arguments</span></span>
<span>  <span class="co"># return some value</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here is a very simple function. Can you guess what it does?</p>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">my_number</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">my_number</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/add1.html">add1</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>Let's make a function that reports p-values in APA format (with "p = [rounded value]" when p &gt;= .001 and "p &lt; .001" when p &lt; .001).</p>
<p>First, we have to name the function. You can name it anything, but try not to duplicate existing functions or you will overwrite them. For example, if you call your function <code>rep</code>, then you will need to use <code><a href="https://rdrr.io/r/base/rep.html">base::rep()</a></code> to access the normal <code>rep</code> function. Let's call our p-value function <code>report_p</code> and set up the framework of the function.</p>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="arguments" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">8.4.2</span> Arguments<a class="anchor" aria-label="anchor" href="#arguments"><i class="fas fa-link"></i></a>
</h3>
<p>We need to add one <a class="glossary" target="_blank" title="A variable that provides input to a function." href="https://psyteachr.github.io/glossary/a#argument">argument</a>, the p-value you want to report. The names you choose for the arguments are private to that argument, so it is not a problem if they conflict with other variables in your script. You put the arguments in the parentheses of <code>function()</code> in the order you want them to default (just like the built-in functions you've used before).</p>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="defaults" class="section level3" number="8.4.3">
<h3>
<span class="header-section-number">8.4.3</span> Argument defaults<a class="anchor" aria-label="anchor" href="#defaults"><i class="fas fa-link"></i></a>
</h3>
<p>You can add a default value to any argument. If that argument is skipped, then the function uses the default argument. It probably doesn't make sense to run this function without specifying the p-value, but we can add a second argument called <code>digits</code> that defaults to 3, so we can round p-values to any number of digits.</p>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we need to write some code inside the function to process the input arguments and turn them into a <strong>return</strong>ed output. Put the output as the last item in function.</p>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">.001</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">reported</span> <span class="op">=</span> <span class="st">"p &lt; .001"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">roundp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span></span>
<span>    <span class="va">reported</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p ="</span>, <span class="va">roundp</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">reported</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>You might also see the returned output inside of the <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> function. This does the same thing.</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">.001</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">reported</span> <span class="op">=</span> <span class="st">"p &lt; .001"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">roundp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span></span>
<span>    <span class="va">reported</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p ="</span>, <span class="va">roundp</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">reported</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When you run the code defining your function, it doesn't output anything, but makes a new object in the Environment tab under <strong><code>Functions</code></strong>. Now you can run the function.</p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">report_p</span><span class="op">(</span><span class="fl">0.04869</span><span class="op">)</span></span>
<span><span class="fu">report_p</span><span class="op">(</span><span class="fl">0.0000023</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "p = 0.049"
## [1] "p &lt; .001"</code></pre>
</div>
<div id="scope" class="section level3" number="8.4.4">
<h3>
<span class="header-section-number">8.4.4</span> Scope<a class="anchor" aria-label="anchor" href="#scope"><i class="fas fa-link"></i></a>
</h3>
<p>What happens in a function stays in a function. You can change the value of a variable passed to a function, but that won't change the value of the variable outside of the function, even if that variable has the same name as the one in the function.</p>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reported</span> <span class="op">&lt;-</span> <span class="st">"not changed"</span></span>
<span></span>
<span><span class="co"># inside this function, reported == "p = 0.002"</span></span>
<span><span class="fu">report_p</span><span class="op">(</span><span class="fl">0.0023</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">reported</span> <span class="co"># still "not changed"</span></span></code></pre></div>
<pre><code>## [1] "p = 0.002"
## [1] "not changed"</code></pre>
</div>
<div id="warnings-errors" class="section level3" number="8.4.5">
<h3>
<span class="header-section-number">8.4.5</span> Warnings and errors<a class="anchor" aria-label="anchor" href="#warnings-errors"><i class="fas fa-link"></i></a>
</h3>
<div class="try">
What happens when you omit the argument for <code>p</code>? Or if you set <code>p</code> to 1.5 or "a"?

</div>
<p>You might want to add a more specific warning and stop running the function code if someone enters a value that isn't a number. You can do this with the <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code> function.</p>
<p>If someone enters a number that isn't possible for a p-value (0-1), you might want to warn them that this is probably not what they intended, but still continue with the function. You can do this with <code><a href="https://rdrr.io/r/base/warning.html">warning()</a></code>.</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"p must be a number"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"p-values are normally greater than 0"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"p-values are normally less than 1"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">.001</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">reported</span> <span class="op">=</span> <span class="st">"p &lt; .001"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">roundp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">digits</span><span class="op">)</span></span>
<span>    <span class="va">reported</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p ="</span>, <span class="va">roundp</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">reported</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">report_p</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Error in report_p(): argument "p" is missing, with no default</code></pre>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">report_p</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Error in report_p("a"): p must be a number</code></pre>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">report_p</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in report_p(-2): p-values are normally greater than 0</code></pre>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">report_p</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in report_p(2): p-values are normally less than 1</code></pre>
<pre><code>## [1] "p &lt; .001"
## [1] "p = 2"</code></pre>
</div>
</div>
<div id="iterating-your-own-functions" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Iterating your own functions<a class="anchor" aria-label="anchor" href="#iterating-your-own-functions"><i class="fas fa-link"></i></a>
</h2>
<div id="build-code" class="section level3" number="8.5.1">
<h3>
<span class="header-section-number">8.5.1</span> Build code<a class="anchor" aria-label="anchor" href="#build-code"><i class="fas fa-link"></i></a>
</h3>
<p>First, let's build up the code that we want to iterate.</p>
<div id="simulate-and-structure-data" class="section level4" number="8.5.1.1">
<h4>
<span class="header-section-number">8.5.1.1</span> Simulate and structure data<a class="anchor" aria-label="anchor" href="#simulate-and-structure-data"><i class="fas fa-link"></i></a>
</h4>
<p>Create a vector of 20 random numbers drawn from a normal distribution with a mean of 5 and standard deviation of 1 using the <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code> function and store them in the variable <code>A</code>.</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>A <code>tibble</code> is a type of table or <code>data.frame</code>. The function <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble::tibble()</a></code> creates a tibble with a column for each argument. Each argument takes the form <code>column_name = data_vector</code>.</p>
<p>Create a table called <code>dat</code> including two vectors: <code>A</code> that is a vector of 20 random normally distributed numbers with a mean of 5 and SD of 1, and <code>B</code> that is a vector of 20 random normally distributed numbers with a mean of 5.5 and SD of 1.</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="statistical-test" class="section level4" number="8.5.1.2">
<h4>
<span class="header-section-number">8.5.1.2</span> Statistical test<a class="anchor" aria-label="anchor" href="#statistical-test"><i class="fas fa-link"></i></a>
</h4>
<p>You can run a Welch two-sample t-test by including the two samples you made as the first two arguments to the function <code>t.test</code>. You can reference one column of a table by its names using the format <code>table_name$column_name</code></p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A</span>, <span class="va">dat</span><span class="op">$</span><span class="va">B</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  dat$A and dat$B
## t = -1.7716, df = 36.244, p-value = 0.08487
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.2445818  0.0838683
## sample estimates:
## mean of x mean of y 
##  4.886096  5.466453</code></pre>
<p>You can also convert the table to long format using the <code>gather</code> function and specify the t-test using the format <code>dv_column~grouping_column</code>.</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">longdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">group</span>, <span class="va">score</span>, <span class="va">A</span><span class="op">:</span><span class="va">B</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">score</span><span class="op">~</span><span class="va">group</span>, data <span class="op">=</span> <span class="va">longdat</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  score by group
## t = -1.7716, df = 36.244, p-value = 0.08487
## alternative hypothesis: true difference in means between group A and group B is not equal to 0
## 95 percent confidence interval:
##  -1.2445818  0.0838683
## sample estimates:
## mean in group A mean in group B 
##        4.886096        5.466453</code></pre>
</div>
<div id="tidy-output" class="section level4" number="8.5.1.3">
<h4>
<span class="header-section-number">8.5.1.3</span> Tidy output<a class="anchor" aria-label="anchor" href="#tidy-output"><i class="fas fa-link"></i></a>
</h4>
<p>You can use the function <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code> to extract the data from a statistical test in a table format. The example below pipes everything together.</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">score</span>, <span class="va">A</span><span class="op">:</span><span class="va">B</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">score</span><span class="op">~</span><span class="va">group</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
estimate1
</th>
<th style="text-align:right;">
estimate2
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
parameter
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
<th style="text-align:left;">
method
</th>
<th style="text-align:left;">
alternative
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
-0.1135539
</td>
<td style="text-align:right;">
5.004773
</td>
<td style="text-align:right;">
5.118327
</td>
<td style="text-align:right;">
-0.3782388
</td>
<td style="text-align:right;">
0.7075268
</td>
<td style="text-align:right;">
35.16785
</td>
<td style="text-align:right;">
-0.7229241
</td>
<td style="text-align:right;">
0.4958162
</td>
<td style="text-align:left;">
Welch Two Sample t-test
</td>
<td style="text-align:left;">
two.sided
</td>
</tr></tbody>
</table></div>
</div>
<div class="info">
<p>In the pipeline above, <code>t.test(score~group, data = _)</code> uses the <code>_</code> notation to change the location of the piped-in data table from it's default position as the first argument to a different position.</p>
</div>
</div>
<div id="extract-important-values" class="section level4" number="8.5.1.4">
<h4>
<span class="header-section-number">8.5.1.4</span> Extract important values<a class="anchor" aria-label="anchor" href="#extract-important-values"><i class="fas fa-link"></i></a>
</h4>
<p>Finally, we can extract a single value from this results table using <code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code>.</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">score</span>, <span class="va">A</span><span class="op">:</span><span class="va">B</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">score</span><span class="op">~</span><span class="va">group</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">p.value</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.7550108</code></pre>
</div>
</div>
<div id="custom-function" class="section level3" number="8.5.2">
<h3>
<span class="header-section-number">8.5.2</span> Custom function<a class="anchor" aria-label="anchor" href="#custom-function"><i class="fas fa-link"></i></a>
</h3>
<p>Next, we can group the code above inside a function.</p>
<p>First, name your function <code>t_sim</code> and wrap the code above in a function with no arguments.</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">score</span>, <span class="va">A</span><span class="op">:</span><span class="va">B</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">score</span><span class="op">~</span><span class="va">group</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">p.value</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run it a few times to see what happens.</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">t_sim</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.2744559</code></pre>
<div id="iterate" class="section level4" number="8.5.2.1">
<h4>
<span class="header-section-number">8.5.2.1</span> Iterate<a class="anchor" aria-label="anchor" href="#iterate"><i class="fas fa-link"></i></a>
</h4>
<p>Let's run the <code>t_sim</code> function 1000 times, assign the resulting p-values to a vector called <code>reps</code>, and check what proportion of p-values are lower than alpha (e.g., .05). This number is the power for this analysis.</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu">t_sim</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">.05</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">reps</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">power</span></span></code></pre></div>
<pre><code>## [1] 0.329</code></pre>
</div>
<div id="seed" class="section level4" number="8.5.2.2">
<h4>
<span class="header-section-number">8.5.2.2</span> Set seed<a class="anchor" aria-label="anchor" href="#seed"><i class="fas fa-link"></i></a>
</h4>
<p>You can use the <code>set.seed</code> function before you run a function that uses random numbers to make sure that you get the same random data back each time. You can use any integer you like as the seed.</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">90201</span><span class="op">)</span></span></code></pre></div>
<div class="warning">
<p>Make sure you don't ever use <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> <strong>inside</strong> of a simulation function, or you will just simulate the exact same data over and over again.</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:img-seed-alignment"></span>
<img src="images/memes/seed_alignment.png" alt="&amp;commat;KellyBodwin" width="100%"><p class="caption">
Figure 8.2: @KellyBodwin
</p>
</div>
</div>
<div id="add-arguments" class="section level4" number="8.5.2.3">
<h4>
<span class="header-section-number">8.5.2.3</span> Add arguments<a class="anchor" aria-label="anchor" href="#add-arguments"><i class="fas fa-link"></i></a>
</h4>
<p>You can just edit your function each time you want to calculate power for a different sample n, but it is more efficient to build this into your function as an arguments. Redefine <code>t_sim</code>, setting arguments for the mean and SD of group A, the mean and SD of group B, and the number of subjects per group. Give them all default values.</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">m1</span><span class="op">=</span><span class="fl">0</span>, <span class="va">sd1</span><span class="op">=</span><span class="fl">1</span>, <span class="va">m2</span><span class="op">=</span><span class="fl">0</span>, <span class="va">sd2</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">m1</span>, <span class="va">sd1</span><span class="op">)</span>,</span>
<span>    B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">m2</span>, <span class="va">sd2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">score</span>, <span class="va">A</span><span class="op">:</span><span class="va">B</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">score</span><span class="op">~</span><span class="va">group</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">p.value</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="test-your-function" class="section level3" number="8.5.3">
<h3>
<span class="header-section-number">8.5.3</span> Test your function<a class="anchor" aria-label="anchor" href="#test-your-function"><i class="fas fa-link"></i></a>
</h3>
<p>Test your function with some different values to see if the results make sense.</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">t_sim</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu">t_sim</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.8460064
## [1] 0.0002446404</code></pre>
<p>Use <code>replicate</code> to calculate power for 100 subjects/group with an effect size of 0.2 (e.g., A: m = 0, SD = 1; B: m = 0.2, SD = 1). Use 1000 replications.</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu">t_sim</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">reps</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span></span>
<span><span class="va">power</span></span></code></pre></div>
<pre><code>## [1] 0.284</code></pre>
<p>Compare this to power calculated from the <code>power.t.test</code> function.</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, delta <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">1</span>, type<span class="op">=</span><span class="st">"two.sample"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 100
##           delta = 0.2
##              sd = 1
##       sig.level = 0.05
##           power = 0.2902664
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<div class="try">
<p>Calculate power via simulation and <code>power.t.test</code> for the following tests:</p>
<ul>
<li>20 subjects/group, A: m = 0, SD = 1; B: m = 0.2, SD = 1</li>
<li>40 subjects/group, A: m = 0, SD = 1; B: m = 0.2, SD = 1</li>
<li>20 subjects/group, A: m = 10, SD = 1; B: m = 12, SD = 1.5</li>
</ul>
</div>
</div>
</div>
<div id="glossary-func" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Glossary<a class="anchor" aria-label="anchor" href="#glossary-func"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
definition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/a.html#argument" class="glossary" target="_blank">argument</a>
</td>
<td style="text-align:left;">
A variable that provides input to a function.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/d.html#data-type" class="glossary" target="_blank">data type</a>
</td>
<td style="text-align:left;">
The kind of data represented by an object.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/d.html#double" class="glossary" target="_blank">double</a>
</td>
<td style="text-align:left;">
A data type representing a real decimal number
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/f.html#function" class="glossary" target="_blank">function</a>
</td>
<td style="text-align:left;">
A named section of code that can be reused.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/i.html#iteration" class="glossary" target="_blank">iteration</a>
</td>
<td style="text-align:left;">
Repeating a process or function
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/m.html#matrix" class="glossary" target="_blank">matrix</a>
</td>
<td style="text-align:left;">
A container data type consisting of numbers arranged into a fixed number of rows and columns
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="resources-func" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Further Resources<a class="anchor" aria-label="anchor" href="#resources-func"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Chapters 19 and 21 of <a href="http://r4ds.had.co.nz">R for Data Science</a>
</li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/purrr.pdf">Apply functions with purrr cheat sheet</a></li>
</ul>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyTeachR_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});


function openCity(evt, cityName) {
  // Declare all variables
  var i, tabcontent, tablinks;

  // Get all elements with class="tabcontent" and hide them
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Get all elements with class="tablinks" and remove the class "active"
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  // Show the current tab, and add an "active" class to the button that opened the tab
  document.getElementById(cityName).style.display = "block";
  evt.currentTarget.className += " active";
} 

</script><div class="chapter-nav">
<div class="prev"><a href="dplyr.html"><span class="header-section-number">7</span> Data Wrangling</a></div>
<div class="next"><a href="sim.html"><span class="header-section-number">9</span> Probability &amp; Simulation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#func"><span class="header-section-number">8</span> Iteration &amp; Functions</a></li>
<li>
<a class="nav-link" href="#ilo-func"><span class="header-section-number">8.1</span> Learning Objectives</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#basic-3">Basic</a></li>
<li><a class="nav-link" href="#intermediate-3">Intermediate</a></li>
<li><a class="nav-link" href="#advanced">Advanced</a></li>
</ul>
</li>
<li><a class="nav-link" href="#setup-func"><span class="header-section-number">8.2</span> Setup</a></li>
<li>
<a class="nav-link" href="#iteration-functions"><span class="header-section-number">8.3</span> Iteration functions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#rep"><span class="header-section-number">8.3.1</span> rep()</a></li>
<li><a class="nav-link" href="#seq"><span class="header-section-number">8.3.2</span> seq()</a></li>
<li><a class="nav-link" href="#replicate"><span class="header-section-number">8.3.3</span> replicate()</a></li>
<li><a class="nav-link" href="#map-apply"><span class="header-section-number">8.3.4</span> map() and apply() functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#custom-functions"><span class="header-section-number">8.4</span> Custom functions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#structure-function"><span class="header-section-number">8.4.1</span> Structuring a function</a></li>
<li><a class="nav-link" href="#arguments"><span class="header-section-number">8.4.2</span> Arguments</a></li>
<li><a class="nav-link" href="#defaults"><span class="header-section-number">8.4.3</span> Argument defaults</a></li>
<li><a class="nav-link" href="#scope"><span class="header-section-number">8.4.4</span> Scope</a></li>
<li><a class="nav-link" href="#warnings-errors"><span class="header-section-number">8.4.5</span> Warnings and errors</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#iterating-your-own-functions"><span class="header-section-number">8.5</span> Iterating your own functions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#build-code"><span class="header-section-number">8.5.1</span> Build code</a></li>
<li><a class="nav-link" href="#custom-function"><span class="header-section-number">8.5.2</span> Custom function</a></li>
<li><a class="nav-link" href="#test-your-function"><span class="header-section-number">8.5.3</span> Test your function</a></li>
</ul>
</li>
<li><a class="nav-link" href="#glossary-func"><span class="header-section-number">8.6</span> Glossary</a></li>
<li><a class="nav-link" href="#resources-func"><span class="header-section-number">8.7</span> Further Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/reprores-v3/blob/master/book/08-func.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/reprores-v3/edit/master/book/08-func.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Skills for Reproducible Research</strong>: <br><a href="https://doi.org/10.5281/zenodo.6527194"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.6527194.svg" alt="DOI: 10.5281/zenodo.6527194"></a>" was written by . It was last built on 2022-08-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
